<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pagination Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .pagination {
        display: flex;
        gap: 10px;
        align-items: center;
        margin: 20px 0;
      }
      button {
        padding: 8px 16px;
        border: 1px solid #ccc;
        background: white;
        cursor: pointer;
        border-radius: 4px;
      }
      button:hover {
        background: #f0f0f0;
      }
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .current-page {
        background: #007bff;
        color: white;
      }
      .items {
        border: 1px solid #ddd;
        padding: 20px;
        margin: 10px 0;
        min-height: 200px;
      }
      .item {
        padding: 5px;
        border-bottom: 1px solid #eee;
      }
      .stats {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Pagination Test for Large Dataset</h1>
      <p>
        Simulating pagination through 1,632,633 items with memory-safe chunking
      </p>

      <div class="stats">
        <div>
          <strong>Total Items:</strong> <span id="total-items">1,632,633</span>
        </div>
        <div>
          <strong>Items Per Page:</strong> <span id="items-per-page">100</span>
        </div>
        <div>
          <strong>Total Pages:</strong> <span id="total-pages">16,327</span>
        </div>
        <div>
          <strong>Current Page:</strong> <span id="current-page">1</span>
        </div>
        <div>
          <strong>Memory Limit:</strong>
          <span id="memory-limit">1000</span> items max
        </div>
      </div>

      <div class="pagination">
        <button id="prev-btn" onclick="goToPage(currentPage - 1)">
          Previous
        </button>
        <span
          >Page <span id="page-display">1</span> of
          <span id="total-pages-display">16,327</span></span
        >
        <button id="next-btn" onclick="goToPage(currentPage + 1)">Next</button>

        <input
          type="number"
          id="page-input"
          value="1"
          min="1"
          max="16327"
          style="width: 80px; margin-left: 20px"
        />
        <button
          onclick="goToPage(parseInt(document.getElementById('page-input').value))"
        >
          Go
        </button>
      </div>

      <div class="items" id="items-container">Loading items...</div>

      <div class="pagination">
        <button onclick="goToPage(currentPage - 1)">Previous</button>
        <span
          >Page <span id="page-display-2">1</span> of
          <span id="total-pages-display-2">16,327</span></span
        >
        <button onclick="goToPage(currentPage + 1)">Next</button>
      </div>
    </div>

    <script>
      // Simulate the large dataset
      const TOTAL_ITEMS = 1632633;
      const ITEMS_PER_PAGE = 100;
      const MEMORY_LIMIT = 1000;
      const TOTAL_PAGES = Math.ceil(TOTAL_ITEMS / ITEMS_PER_PAGE);

      let currentPage = 1;
      let currentItems = [];

      // Simulate generating ITTID data for a specific page
      function generatePageData(page) {
        const startIndex = (page - 1) * ITEMS_PER_PAGE;
        const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, TOTAL_ITEMS);
        const items = [];

        for (let i = startIndex; i < endIndex; i++) {
          items.push({
            ittid: `ITTID_${String(i + 1).padStart(8, "0")}`,
            hotelName: `Hotel ${i + 1}`,
            index: i + 1,
          });
        }

        return items;
      }

      function updateDisplay() {
        // Update page displays
        document.getElementById("current-page").textContent = currentPage;
        document.getElementById("page-display").textContent = currentPage;
        document.getElementById("page-display-2").textContent = currentPage;
        document.getElementById("page-input").value = currentPage;

        // Update button states
        document.getElementById("prev-btn").disabled = currentPage === 1;
        document.getElementById("next-btn").disabled =
          currentPage >= TOTAL_PAGES;

        // Generate and display items for current page
        currentItems = generatePageData(currentPage);
        const container = document.getElementById("items-container");

        if (currentItems.length === 0) {
          container.innerHTML =
            '<div class="item">No items found for this page.</div>';
          return;
        }

        // Check memory limit
        const displayItems = currentItems.slice(0, MEMORY_LIMIT);
        const isMemoryLimited = currentItems.length > MEMORY_LIMIT;

        let html = "";
        if (isMemoryLimited) {
          html += `<div style="background: #fff3cd; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
                    <strong>Memory Limit Active:</strong> Showing ${displayItems.length} of ${currentItems.length} items
                </div>`;
        }

        displayItems.forEach((item) => {
          html += `<div class="item">
                    <strong>${item.ittid}</strong> - ${
            item.hotelName
          } (Global Index: ${item.index.toLocaleString()})
                </div>`;
        });

        // Add pagination info
        const startGlobal = (currentPage - 1) * ITEMS_PER_PAGE + 1;
        const endGlobal = Math.min(
          startGlobal + displayItems.length - 1,
          TOTAL_ITEMS
        );

        html += `<div style="background: #e9ecef; padding: 10px; margin-top: 10px; border-radius: 4px;">
                <strong>Page Info:</strong> Showing items ${startGlobal.toLocaleString()} - ${endGlobal.toLocaleString()} of ${TOTAL_ITEMS.toLocaleString()}
            </div>`;

        container.innerHTML = html;
      }

      function goToPage(page) {
        // Validate page number
        if (page < 1 || page > TOTAL_PAGES) {
          alert(`Page must be between 1 and ${TOTAL_PAGES.toLocaleString()}`);
          return;
        }

        currentPage = page;
        updateDisplay();

        console.log(
          `Navigated to page ${page} (items ${(
            (page - 1) * ITEMS_PER_PAGE +
            1
          ).toLocaleString()} - ${Math.min(
            page * ITEMS_PER_PAGE,
            TOTAL_ITEMS
          ).toLocaleString()})`
        );
      }

      // Test specific scenarios
      function testScenarios() {
        console.log("Testing pagination scenarios...");

        // Test first page
        goToPage(1);
        console.log("✓ First page loaded");

        // Test middle page
        goToPage(8000);
        console.log("✓ Middle page loaded");

        // Test last page
        goToPage(TOTAL_PAGES);
        console.log("✓ Last page loaded");

        // Test edge cases
        goToPage(0); // Should show error
        goToPage(TOTAL_PAGES + 1); // Should show error

        // Return to first page
        goToPage(1);
        console.log("✓ All tests completed");
      }

      // Initialize
      updateDisplay();

      // Add test button
      document.body.innerHTML += `
            <div style="text-align: center; margin: 20px;">
                <button onclick="testScenarios()" style="background: #28a745; color: white; padding: 10px 20px;">
                    Run Pagination Tests
                </button>
            </div>
        `;
    </script>
  </body>
</html>
