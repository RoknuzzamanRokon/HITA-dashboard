<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test All Users Check API</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
      }
      button {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      button:hover {
        background-color: #45a049;
      }
      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      .result {
        margin-top: 20px;
        padding: 15px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 4px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 12px;
        max-height: 600px;
        overflow-y: auto;
      }
      .error {
        background-color: #ffebee;
        border-color: #f44336;
        color: #c62828;
      }
      .success {
        background-color: #e8f5e9;
        border-color: #4caf50;
        color: #2e7d32;
      }
      .info {
        background-color: #e3f2fd;
        border-color: #2196f3;
        color: #1565c0;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .user-card {
        background: #f5f5f5;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        border-left: 4px solid #2196f3;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }
      .stat-value {
        font-size: 32px;
        font-weight: bold;
        margin: 10px 0;
      }
      .stat-label {
        font-size: 14px;
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç Test All Users Check API</h1>

      <div class="info">
        <strong>API Endpoint:</strong>
        http://127.0.0.1:8002/v1.0/user/check/all<br />
        <strong>Method:</strong> GET<br />
        <strong>Auth:</strong> Required (Bearer Token)
      </div>

      <div>
        <label for="token">Auth Token:</label><br />
        <input
          type="text"
          id="token"
          placeholder="Enter your auth token"
          style="width: 100%; padding: 8px; margin: 10px 0"
        />
      </div>

      <button onclick="testAPI()">Test API</button>
      <button onclick="clearResults()">Clear Results</button>

      <div id="result" class="result" style="display: none"></div>
      <div id="formatted" style="display: none"></div>
    </div>

    <script>
      async function testAPI() {
        const resultDiv = document.getElementById("result");
        const formattedDiv = document.getElementById("formatted");
        const token = document.getElementById("token").value;

        if (!token) {
          resultDiv.className = "result error";
          resultDiv.textContent = "Please enter an auth token";
          resultDiv.style.display = "block";
          return;
        }

        resultDiv.textContent = "Loading...";
        resultDiv.className = "result";
        resultDiv.style.display = "block";
        formattedDiv.style.display = "none";

        try {
          const response = await fetch(
            "http://127.0.0.1:8002/v1.0/user/check/all",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          const data = await response.json();

          if (response.ok) {
            resultDiv.className = "result success";
            resultDiv.textContent = JSON.stringify(data, null, 2);

            // Display formatted data
            displayFormattedData(data);
          } else {
            resultDiv.className = "result error";
            resultDiv.textContent = `Error ${response.status}: ${JSON.stringify(
              data,
              null,
              2
            )}`;
          }
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `Network Error: ${error.message}`;
        }
      }

      function displayFormattedData(data) {
        const formattedDiv = document.getElementById("formatted");
        formattedDiv.style.display = "block";

        let html = '<div class="container" style="margin-top: 20px;">';
        html += "<h2>üìä Formatted Results</h2>";

        // Statistics
        if (data.statistics) {
          html += '<div class="stats">';
          html += `
                    <div class="stat-card">
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value">${
                          data.pagination?.total || 0
                        }</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="stat-label">Unpaid Users</div>
                        <div class="stat-value">${
                          data.statistics.total_unpaid_users || 0
                        }</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="stat-label">Showing</div>
                        <div class="stat-value">${
                          data.statistics.showing || 0
                        }</div>
                    </div>
                `;
          html += "</div>";
        }

        // Requested By
        if (data.requested_by) {
          html += '<div class="info">';
          html += `<strong>Requested By:</strong> ${data.requested_by.username} (${data.requested_by.role})<br>`;
          html += `<strong>User ID:</strong> ${data.requested_by.user_id}`;
          html += "</div>";
        }

        // Users List
        if (data.users && data.users.length > 0) {
          html += `<h3>üë• Users (${data.users.length})</h3>`;
          data.users.forEach((user) => {
            html += '<div class="user-card">';
            html += `<strong>${user.username}</strong> (${user.email})<br>`;
            html += `<small>Role: ${user.role} | Status: ${
              user.is_active ? "‚úÖ Active" : "‚ùå Inactive"
            }</small><br>`;
            html += `<small>Points: ${user.points?.current_points || 0} / ${
              user.points?.total_points || 0
            } | Payment: ${user.points?.paid_status}</small><br>`;
            html += `<small>Requests: ${user.total_requests} | Activity: ${user.activity_status}</small><br>`;
            if (user.active_suppliers && user.active_suppliers.length > 0) {
              html += `<small>Suppliers: ${user.active_suppliers.join(
                ", "
              )}</small><br>`;
            }
            html += `<small>Created: ${new Date(
              user.created_at
            ).toLocaleString()} by ${user.created_by}</small>`;
            html += "</div>";
          });
        }

        // Pagination
        if (data.pagination) {
          html += '<div class="info">';
          html += `<strong>Pagination:</strong> Page ${data.pagination.page} of ${data.pagination.total_pages} | `;
          html += `Limit: ${data.pagination.limit} | Total: ${data.pagination.total}<br>`;
          html += `Has Next: ${
            data.pagination.has_next ? "‚úÖ" : "‚ùå"
          } | Has Prev: ${data.pagination.has_prev ? "‚úÖ" : "‚ùå"}`;
          html += "</div>";
        }

        html += "</div>";
        formattedDiv.innerHTML = html;
      }

      function clearResults() {
        document.getElementById("result").style.display = "none";
        document.getElementById("formatted").style.display = "none";
      }

      // Try to load token from localStorage
      window.addEventListener("load", () => {
        const savedToken = localStorage.getItem("admin_auth_token");
        if (savedToken) {
          document.getElementById("token").value = savedToken;
        }
      });
    </script>
  </body>
</html>
